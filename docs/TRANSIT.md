# Промежуточный контекст разработки

## Концепция проекта

**GIIS Server Selector** - GUI утилита для управления stunnel конфигурацией на Windows. Приложение позволяет переключать сервер stunnel между несколькими предустановленными вариантами через удобный графический интерфейс.

### Основная задача
Упрощение процесса переключения между различными серверами stunnel (промышленный/тестовые контуры) для пользователей без необходимости ручного редактирования конфигурационных файлов.

## Текущее состояние проекта

### Реализовано
✅ GUI приложение на tkinter с функциональностью:
- Выбор файла конфигурации stunnel через диалог
- Сохранение пути к конфигу в AppData
- Отображение текущего подключенного сервера
- Выбор нового сервера из списка (3 варианта)
- Перезапуск службы Stunnel при смене сервера
- Логирование всех операций в файл
- Кнопка открытия лога и папки с логами

✅ Безопасность:
- Проверка прав администратора при запуске
- Автоматический перезапуск с повышенными правами
- Резервное копирование конфига перед изменениями
- Восстановление из бэкапа при ошибках

✅ Компиляция:
- Создан скрипт сборки `build.bat`
- Успешная компиляция в exe через PyInstaller
- Флаг `--uac-admin` для запроса прав администратора

✅ Документация:
- FILES.md - файловая структура
- CLASSES.md - описание классов
- TECH.md - технический стек
- TRANSIT.md - этот файл

### Доступные серверы
1. `195.209.130.9` - промышленный контур
2. `195.209.130.45` - тестовый контур (промышленный)
3. `195.209.130.19` - тестовый контур (новый функционал)

## Архитектура

### Основные компоненты
1. **StunnelManager** - класс управления конфигом и службой
2. **StunnelGUI** - tkinter интерфейс
3. **Вспомогательные функции** - проверка прав администратора

### Алгоритм смены сервера
1. Остановка службы Stunnel (net stop или taskkill)
2. Создание резервной копии stunnel.conf
3. Изменение строки `connect=` в конфиге
4. Запуск службы Stunnel
5. Логирование результатов

### Хранение данных
- Настройки: `%APPDATA%\GIIS_ServerSelector\settings.json`
- Логи: `%APPDATA%\GIIS_ServerSelector\stunnel_manager_*.log`

## История разработки

### Версия 0.1.0 (Текущая)
- Создан базовый проект с uv
- Реализован полный функционал GUI приложения
- Портирован функционал из script.bat
- Добавлено логирование и сохранение настроек
- Компиляция в exe

## Известные ограничения

1. Работает только на Windows
2. Требует установленную службу Stunnel
3. Требует права администратора
4. Список серверов захардкожен в коде (можно расширить через конфиг)

## Возможные улучшения

### Приоритет 1 (важные)
- [ ] Добавить иконку приложения
- [ ] Обработка случая когда служба не установлена
- [ ] Валидация IP адреса при чтении конфига

### Приоритет 2 (желательные)
- [ ] Возможность добавления пользовательских серверов
- [ ] История изменений серверов
- [ ] Автоматическая проверка доступности сервера после переключения
- [ ] Опция резервного копирования старых конфигов

### Приоритет 3 (дополнительные)
- [ ] Темная тема интерфейса
- [ ] Минимизация в системный трей
- [ ] Экспорт/импорт настроек

## Технические детали

### Управление службой Windows
- Основной метод: `net stop/start "Stunnel"`
- Резервный метод: `taskkill /f /im stunnel.exe`

### Парсинг конфига
- Поиск строки начинающейся с `connect=`
- Извлечение IP до символа `:`
- Замена целой строки на `connect=NEW_IP:443`

## Заметки для будущей разработки

1. При добавлении новых серверов обновить константу `SERVERS` в классе `StunnelManager`
2. Для изменения пути по умолчанию к конфигу - изменить в `script.bat` строку 35
3. Логи автоматически создаются с timestamp, старые не удаляются
4. PyInstaller создает одиночный exe в папке `dist/`

## Контакты

**Разработчик**: Даниил
**GitHub**: https://github.com/imdeniil/
**Email**: keemor821@gmail.com

---

*Последнее обновление: 2025-10-02*
